#
# Cookbook Name:: ipplan
# Recipe:: default
#
# Copyright 2012, Clearchannel Communications
# Written by Jake Plimack <jakeplimack@clearchannel.com>
#
# All rights reserved - Do Not Redistribute
#

version = node[:ipplan][:version]

remote_file "#{Chef::Config[:file_cache_path]}/ipplan-#{version}.tar.gz" do
  puts "Downloading from #{node[:ipplan][:package_url]}"
  source node[:ipplan][:package_url]
#  checksum node[:ipplan][:checksum]
  action :create_if_missing
end

directory node[:ipplan][:install_path] do
  owner node[:apache][:user]
  group node[:apache][:group]
  mode 0755
end

bash "extract-package" do
  cwd Chef::Config[:file_cache_path]
  code <<-EOH
    tar zxvf ipplan-#{version}.tar.gz
    mv ipplan/* #{node[:ipplan][:install_path]}
  EOH
  not_if "test #{node[:ipplan][:install_path]}/ipplan/index.php"
end
