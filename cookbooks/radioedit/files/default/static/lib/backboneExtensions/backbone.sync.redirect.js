// Generated by CoffeeScript 1.4.0
(function() {

  define(function(require) {
    var $, Backbone;
    Backbone = require('backbone');
    $ = require('jquery');
    Backbone.oldSync = Backbone.sync;
    return Backbone.sync = function(method, model, options) {
      var deferred;
      if (method === 'create' || method === 'update') {
        deferred = new $.Deferred();
        deferred.done(options.success);
        options.success = function(response, status, xhr) {
          var location;
          location = xhr.getResponseHeader('Location');
          if ((response === null || response === (void 0) || response === '') && xhr.status === 201 && (location != null)) {
            return $.ajax({
              url: location,
              success: deferred.resolve,
              error: deferred.reject
            });
          } else {
            return deferred.resolveWith(options.context || options, [response, status, xhr]);
          }
        };
        deferred.fail(options.error);
        options.error = function(xhr, status, response) {
          return deferred.rejectWith(options.context || options, [xhr, status, response]);
        };
        deferred.request = Backbone.oldSync(method, model, options);
        return deferred;
      }
      return Backbone.oldSync(method, model, options);
    };
  });

}).call(this);
